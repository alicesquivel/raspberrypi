## 1. Set Up Raspberry Pi (Data Collection)

#### Sensor documentation: https://www.waveshare.com/wiki/BME680_Environmental_Sensor 

### Update System Packages
Open Terminal:
Open the terminal on your Raspberry Pi or connect to it via SSH.
Update Package Lists:
```
sudo apt update
```
Upgrade Installed Packages:
```
sudo apt upgrade
```
Clean Up Unused Packages:
```
sudo apt autoremove
```
### Install Required Packages
Python Libraries:

Install necessary Python libraries for sensor data collection and MQTT publishing:
```
pip3 install bme680 paho-mqtt
```
Enable I2C Interface (if using I2C sensors):

If your sensor communicates via I2C, enable the I2C interface:
```
Run sudo raspi-config.
Navigate to Interfacing Options -> I2C -> Yes to enable the I2C interface.
```

### 4. Connect and Test Sensor (BME680)
Connect Sensor:
Connect your BME680 sensor to the Raspberry Pi according to its datasheet or manufacturer's instructions. Ensure power (VCC/GND) and communication (I2C/SPI) lines are correctly connected.
Test Sensor Communication:

Run a test script to ensure the sensor is communicating correctly.
```
Sensor connected: True
```

## 2. Set Up Cloud VM in Chameleon Cloud (InfluxDB and Telegraf)
Step-by-Step Guide

### 1. Set Up Ubuntu 22.04 Virtual Machine
Create Ubuntu 22.04 VM:
Create a virtual machine instance with Ubuntu 22.04 LTS

Connect to VM:
SSH into your Ubuntu VM using your preferred SSH client.

### 2. Install InfluxDB
Update Package Lists:
```
sudo apt update
```
Install InfluxDB:
```
sudo apt install influxdb
```
Start and Enable InfluxDB Service:
```
sudo systemctl start influxdb
sudo systemctl enable influxdb
```
Configure InfluxDB:
Install InfluxDB CLI
```
sudo apt install influxdb-client
```
Access the InfluxDB CLI:
```
influx
```
Create a database named mydatabase:
```
CREATE DATABASE mydatabase
```
Create a user (replace your_username and your_password with your desired credentials):
```
CREATE USER your_username WITH PASSWORD 'your_password' WITH ALL PRIVILEGES
```
Exit the InfluxDB CLI:
```
exit
```
### 3. Install Telegraf
Download and Install Telegraf:
```
sudo apt install telegraf
```
Configure Telegraf for MQTT and InfluxDB:

Edit the Telegraf configuration file:
```
sudo nano /etc/telegraf/telegraf.conf
```
Update the configuration to subscribe to MQTT for pressure data and store it in InfluxDB. Replace placeholders (YOUR_MQTT_BROKER_IP, INFLUXDB_VM_IP, your_username, your_password, mydatabase) with your actual values:
```
[[inputs.mqtt_consumer]]
  servers = ["tcp://YOUR_MQTT_BROKER_IP:1883"]
  topics = [
    "sensor/pressure"
  ]
  qos = 1
  data_format = "json"
  json_string_fields = ["timestamp"]
  name_override = "pressure_sensor"
  tag_keys = ["timestamp"]

[[outputs.influxdb]]
  urls = ["http://INFLUXDB_VM_IP:8086"]
  database = "mydatabase"
  username = "your_username"
  password = "your_password"
  retention_policy = ""
  timeout = "5s"
  influx_skip_database_creation = true
```
Save and close the file (Ctrl + X, then Y to confirm and Enter to save).

Restart Telegraf Service:
```
sudo systemctl restart telegraf
```
### 4. Verify and Monitor
Monitor MQTT Activity:
Use MQTT client tools (mosquitto_sub or similar) to subscribe to sensor/pressure topic and verify data publication from your Raspberry Pi.

Check InfluxDB:
Access InfluxDB from your Ubuntu VM or local machine using influx CLI or InfluxDB UI to verify data storage in the mydatabase database under the pressure_sensor measurement.

**Notes:**
1. Security: Ensure proper security measures (e.g., firewall rules, encryption) are applied to your MQTT broker, InfluxDB, and VM instance.
2. Expansion: To add more sensors, extend the Python script to handle additional sensor data and update Telegraf configuration accordingly.

Verify Sensor Readings:

Check if the sensor can read basic data (temperature, pressure, humidity) using sample scripts provided by the sensor manufacturer or library documentation.

## 5. Set Up MQTT Broker (Optional, if not using cloud-based MQTT)
Install MQTT Broker (e.g., Mosquitto):
If you're not using a cloud-based MQTT broker, install Mosquitto:
```
sudo apt install mosquitto mosquitto-clients
```
Configure and Start Mosquitto:
Mosquitto should start automatically after installation. Configure it as needed for your network setup and security.

## 6. Secure Raspberry Pi
Change Default Password:

Ensure you change the default password for the pi user and create a new user with appropriate permissions if necessary.
Enable Firewall (UFW):
Set up a firewall (UFW) to restrict access to your Raspberry Pi:
```
sudo apt install ufw
sudo ufw allow ssh  # Allow SSH access
sudo ufw enable
```



